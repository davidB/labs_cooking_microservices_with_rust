<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>reveal.js</title>

	<link rel="stylesheet" href="css/additions.css">
	<link rel="stylesheet" href="css/reveal.css">
	<!--link rel="stylesheet" href="css/theme/black.css"-->
	<link rel="stylesheet" href="css/theme/devoxxfr.css">
	<!--
	<script defer src="https://use.fontawesome.com/releases/v5.0.8/js/solid.js" integrity="sha384-+Ga2s7YBbhOD6nie0DzrZpJes+b2K1xkpKxTFFcx59QmVPaSA8c7pycsNaFwUK6l"
	 crossorigin="anonymous"></script>
	<script defer src="https://use.fontawesome.com/releases/v5.0.8/js/brands.js" integrity="sha384-sCI3dTBIJuqT6AwL++zH7qL8ZdKaHpxU43dDt9SyOzimtQ9eyRhkG3B7KMl6AO19"
	 crossorigin="anonymous"></script>
	<script defer src="https://use.fontawesome.com/releases/v5.0.8/js/fontawesome.js" integrity="sha384-7ox8Q2yzO/uWircfojVuCQOZl+ZZBg2D2J5nkpLqzH1HY0C1dHlTKIbpRz/LG23c"
	 crossorigin="anonymous"></script>
	-->
	<script defer src="lib/font/fontawesome-5.0.10/svg-with-js/js/fa-solid.min.js"></script>
	<script defer src="lib/font/fontawesome-5.0.10/svg-with-js/js/fa-brands.min.js"></script>
	<script defer src="lib/font/fontawesome-5.0.10/svg-with-js/js/fontawesome.min.js"></script>
	<!-- Theme used for syntax highlighting of code -->
	<link rel="stylesheet" type="text/css" href="lib/css/dracula.css"/>
	<!--link rel="stylesheet" type="text/css" href="lib/css/zenburn.css"/-->
	<link rel="stylesheet" type="text/css" href="css/asciinema-player.css" />
	<!-- Printing and PDF exports -->
	<script>
		var link = document.createElement('link');
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
		document.getElementsByTagName('head')[0].appendChild(link);
	</script>
	<style>
		dl, ul, ol {
			width:100%;
		}
	</style>
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section id="intro">
				<section data-state="intro">
					<h1>Cuisiner un micro-service avec Rust
						<br>
						<img src="images/rust.svg" style="background:none;box-shadow:none;" />
					</h1>
					<p>
						David Bernard
						<a href="https://github.com/davidB" target="_blank">
							<i class="fab fa-github"></i> davidB</a>
						<br /> François Mockers
						<a href="https://github.com/mockersf" target="_blank">
							<i class="fab fa-github"></i> mockersf</a>
					</p>
				</section>
				<section>
					<blockquote>
						Petite recette pour réaliser un micro-service codé en Rust de zéro au déploiement. Afin de découvrir Rust au travers de son
						écosysteme, ainsi que l'intégration dans une "infrastructure micro-services".
						<br/> Car un langage n'est pas qu'une syntaxe et un compilateur, mais aussi ce qu'il y a autour: outils, documentation,
						communauté, ...
					</blockquote>
				</section>
				<section class="questions" data-state="flash" align="center">
					<i class="fas fa-question fa-10x"></i>
				</section>
			</section>
			<section>
				<section data-state="flash" align="center">
					<h1>Ingrédients</h1>
					<aside class="notes">le langage, les docs en ligne (et package hors ligne)</aside>
				</section>
				<section>
					<h2><a href="https://rust-lang.org/" target="_blank">https://rust-lang.org/</a></h2>
					<img data-src="images/screenshots/rust-lang.org.png" width="50%" style="display:block;margin-left:auto;margin-right:auto;" />
					<aside class="notes">expliquer chaque element, la version (frequence), les liens, les features, les lignes de code</aside>
				</section>
				<section>
					<h2>Déclarer une struct</h2>
					<pre><code data-trim data-noescape>
						struct V2 {
							x: f64,
							y: f64,
						}
					</code></pre>
					<pre class="fragment"><code data-trim data-noescape>
						pub struct V2 {
							pub x: f64,
							pub y: f64,
						}
					</code></pre>
					<pre class="fragment"><code data-trim data-noescape>
						fn main(){
							let v = V2{x: 10.0, y: 11_f64};
							println!("display v: {}", v);
						}
					</code></pre>
				</section>
				<section>
					<h2>Ajouter une fonction</h2>
					<pre><code data-trim data-noescape>
							impl V2 {
								fn to_string(&amp;self) -> String {
									format!("V2 {{ x: {}, y: {} }}", self.x, self.y)
								}
							}
							//...
							println!("display v: {}", v.to_string());
					</code></pre>
				</section>
				<section>
					<h2>Idiomatic</h2>
					<pre><code data-trim data-noescape class="shell">
						error[E0277]: `V2` doesn't implement `std::fmt::Display`
						--> src/main.rs:8:31
							|
						8	|     println!("display v: {}", v);
							|                               ^ `V2` cannot be formatted with the default formatter; try using `:?` instead if you are using a format string
							|
							= help: the trait `std::fmt::Display` is not implemented for `V2`
							= note: required by `std::fmt::Display::fmt`
					</code></pre>
					<pre class="fragment"><code data-trim data-noescape class="rust">
						use std::fmt;

						impl fmt::Display for V2 {
							fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -> fmt::Result {
								write!(f, "V2 {{ x: {}, y: {} }}", self.x, self.y)
							}
						}
						//...
						println!("display v {}", v);
					</code></pre>
				</section>
				<section>
					<h2>Dérivation automatique</h2>
					<pre><code data-trim data-noescape class="rust">
						#[derive(Debug, Clone)]
						pub struct V2 {
							pub x: f64,
							pub y: f64,
						}
						println!("display v {}", v);
						println!("debug v {:?}", v);
						println!("debug pretty v {:#?}", v);
					</code></pre>
					<pre><code data-trim data-noescape class="rust">
						display v V2 { x: 10, y: 11 }
						debug v V2 { x: 10.0, y: 11.0 }
						debug pretty v V2 {
							x: 10.0,
							y: 11.0
						}
					</code></pre>
					<ul>
						<li>une struct peut dériver un trait si tous ses composants le dérive déjà</li>
						<li>une enum peut dériver un trait si toutes ses variantes peuvent le dériver</li>
					</ul>
				</section>
				<section>
					<h2>Générique</h2>
					<pre><code data-trim data-noescape class="rust">
					fn twice<T, U>(x: T) -> U
					where
						T: Add&lt;Output=U>,
						T: Copy,
					{
						x + x
					}

					fn main() {
						let one = V2 { x: 1, y: 1 };
						println!("{:?}", twice(one));
					}
					</code></pre>
				</section>
				<section>
					<h2>Déclarer un trait</h2>
					<ul>
						<li class="fragment">un trait définit une fonctionnalité
							<pre><code data-trim data-noescape class="rust">
							pub trait ToString {
								fn to_string(&amp;self) -> String;
							}
							</code></pre>
						</li>
						<li  class="fragment">un trait peut être générique sur ses paramètres / retours
							<pre><code data-trim data-noescape class="rust">
							pub trait Add<RHS = Self> {
								type Output;
								fn add(self, rhs: RHS) -> Self::Output;
							}
							</code></pre>
						</li>
					</ul>
				</section>
				<section>
					<h2>Déclarer un trait</h2>
					<ul>
						<li>un trait peut avoir une implementation par defaut
							<pre><code data-trim data-noescape class="rust">
							pub trait To42 {
								fn to_42(&amp;self) -> i32 { 
									42
								}
							}

							impl To42 for V2{}

							println!("v.to_42 {}", v.to_42());
							</code></pre>
						</li>
					</ul>
				</section>
				<section>
					<h2>Implémenter un operateur</h2>
					<pre><code data-trim data-noescape class="rust">
						impl Add for V2 {
							type Output = V2;
							fn add(self, rhs: V2) -> V2 {
								V2 {
									x: self.x + rhs.x,
									y: self.y + rhs.y,
								}
							}
						}
						
						impl AddAssign for V2 {
							fn add_assign(&amp;mut self, rhs: V2) {
								self.x += rhs.x;
								self.y += rhs.y;
							}
						}
					</code></pre>
				</section>
				<section>
					<h2>Enum</h2>
					<pre><code data-trim data-noescape class="rust">
						enum Colors {
							Blue,
							Yellow,
							Green,
						}
					</code></pre>
					<pre class="fragment"><code data-trim data-noescape class="rust">
						enum Command {
							Help,
							Kill(i32),
							Run {
								path: String,
								options: Vec&lt;String>,
							}
						}
					</code></pre>
					<ul>
						<li class="fragment">permet de contrôler l'exhaustivité d'un pattern matching</li>
						<li class="fragment">Result&lt;T, Err>, Option&lt;T></li>
					</ul>
				</section>
				<section>
					<h2>Macros</h2>
					<pre><code data-trim data-noescape class="rust">
						macro_rules! print_twice {
							( $x:expr ) => {
								{
									println!("{:?}", twice($x));
								}
							};
						}
						print_twice!(V2 { x: 1, y: 1 });
						</code></pre>
					<h4>Macros utiles</h4>
					<ul>
						<li>println!, eprintln!, format!</li>
						<li>vec!</li>
						<li>unreachable!, unimplemented!</li>
						<li>assert!, assert_eq!</li>
						<li>panic!, try!</li>
					</ul>
				</section>
				<section>
					<h2>Closure</h2>
					<pre><code data-trim data-noescape class="rust">
					fn main() {
						let one = V2 { x: 1, y: 1 };
						let twice = |x| x + x;
						
						println!("{:?}", twice(one));
					}
					</code></pre>
					<ul>
						<li>bloc de code finissant par une expression</li>
						<li>les types peuvent être inférés</li>
						<li>peut prendre l'ownership de l'environment: move</li>
					</ul>
				</section>
				<section>
					<h2>ownership / borrow</h2>
					<dl>
					<dt>prendre l'ownership</dt>
					<dd><pre><code data-trim data-noescape class="rust">
						fn f(x: V2) {...}
					</code></pre></dd>
					<dt>emprunter</dt>
					<dd><pre><code data-trim data-noescape class="rust">
						fn f(x: &amp;V2) {...}
					</code></pre></dd>
					<dt>emprunter et pouvoir modifier</dt>
					<dd><pre><code data-trim data-noescape class="rust">
						fn f(x: &amp;mut V2) {...}
					</code></pre></dd>
					</dl>
				</section>
				<section>
					<h2>langage</h2>
					<ul>
						<li>struct, traits, implementation, enum, generics</li>
						<li>function, method, closure</li>
						<li>operators, statement, expression</li>
						<li>ownership, lifecycle</li>
						<li>pattern matching</li>
						<li>macros</li>
						<li>modules</li>
						<li>Result, Option, String, &amp;str, Array, slice, Vec, Iterator, iXX, uXX, fXX</li>
						<li>...</li>
					</ul>
				</section>
				<section>
					<h2>guides</h2>
					<ul>
						<li><a href="https://rust-lang.org/" target="_blank">https://rust-lang.org/</a>
							<ul>
								<li><a href="https://steveklabnik.github.io/rust-in-ten-slides/" target="_blank">https://steveklabnik.github.io/rust-in-ten-slides/</a></li>
								<li><a href="http://intorust.com/" target="_blank">http://intorust.com/</a></li>
								<li><a href="https://rust-lang-nursery.github.io/rust-cookbook/" target="_blank">https://rust-lang-nursery.github.io/rust-cookbook/</a></li>
								<li><a href="https://rust-lang-nursery.github.io/rust-clippy/master/index.html" target="_blank">All the Clippy Lints</a></li>
								<li><a href="https://github.com/rust-unofficial/patterns" target="_blank">https://github.com/rust-unofficial/patterns</a></li>
							</ul>
						</li>
						<li><a href="https://crates.io/" target="_blank">https://crates.io/</a></li>
						<li><a href="https://this-week-in-rust.org/" target="_blank">https://this-week-in-rust.org/</a></li>
						<li><a href="https://www.reddit.com/r/rust/" target="_blank">https://www.reddit.com/r/rust/</a></li>
					</ul>
				</section>
				<section>
					<h2>catalogues</h2>
					<ul>
						<li><a href="https://github.com/rust-unofficial/awesome-rust" target="_blank">https://github.com/rust-unofficial/awesome-rust</a></li>
						<li><a href="https://areweideyet.com/" target="_blank">Are we (I)DE yet?</a></li>
						<li><a href="http://www.arewewebyet.org/" target="_blank">Are we web yet?</a></li>
						<li><a href="http://www.arewelearningyet.com/" target="_blank">Are we learning yet?</a></li>
						<li><a href="http://arewegameyet.com/" target="_blank">Are we game yet?</a></li>
					</ul>
				</section>
				<section class="questions" data-state="flash" align="center">
					<i class="fas fa-question fa-10x"></i>
				</section>
			</section>
			<section>
				<section data-state="flash" align="center">
					<h1>Ustensiles</h1>
					<aside class="notes">l'outil de build, structure de projets, le repository des dépendances, formatage du code, documentation std, tests unitaires,
						exemples, benchs, editeur (rls/vscode/intellij) ...</aside>
				</section>
				<section>
					<h2><a href="https://play.rust-lang.org/" target="_blank">https://play.rust-lang.org/</a></h2>
					<img data-src="images/screenshots/play.rust-lang.org.png" width="60%" style="display:block;margin-left:auto;margin-right:auto;" />
				</section>
				<section>
					<h2><a href="http://rustup.rs/" target="_blank">http://rustup.rs/</a></h2>
					<pre class="fragment"><code data-trim data-noescape class="sh">curl https://sh.rustup.rs -sSf | sh</code></pre>
					<pre class="fragment"><code data-trim data-noescape class="sh">rustup default stable</code></pre>
					<pre class="fragment"><code data-trim data-noescape class="sh">rustup show</code></pre>
					<pre class="fragment"><code data-trim data-noescape class="sh">rustup update</code></pre>
					<pre class="fragment"><code data-trim data-noescape class="sh">rustup component add rustfmt-preview</code></pre>
					<pre class="fragment"><code data-trim data-noescape class="sh">rustup component add rls-preview</code></pre>
					<aside class="notes">
						* check on Windows
					</aside>
				</section>
				<section>
					<h2><a href="https://www.rust-lang.org/fr-FR/" target="_blank">https://www.rust-lang.org/fr-FR/</a></h2>
					<pre class="fragment"><code data-trim data-noescape>rustup doc</code></pre>
					<p class="fragment"><a href="http://devdocs.io/rust/" target="_blank">http://devdocs.io/rust/</a></p>
					<p class="fragment"><a href="https://kapeli.com/dash" target="_blank">Dash</a>, <a href="https://zealdocs.org/" target="_blank">Zeal</a></p>
					<aside class="notes">
						go to the documentation and explain and show
					</aside>
					</section>
				<section>
					<h2>base toolchain</h2>
					<dl>
						<dt>rustc</dt>
						<dd>
							<pre><code data-trim data-noescape class="sh">
								rustc --version
								rustc --help
							</code></pre>
						</dd>
						<dt>rustfmt</dt>
						<dd>
							<pre><code data-trim data-noescape class="sh">rustfmt --help</code></pre>
						</dd>
						<dt>rustdoc</dt>
						<dd>
							<pre><code data-trim data-noescape class="sh">rustdoc --help</code></pre>
						</dd>
						<dt>cargo</dt>
						<dd>
							<pre><code data-trim data-noescape class="sh">cargo --help</code></pre>
						</dd>
					</dl>
				</section>
				<section>
					<asciinema-player src="cast/cargo_1.cast" font-size="medium" speed="2" loop="false" rows="24"></asciinema-player>
				</section>
				<section>
					<h2>Cargo.toml</h2>
					<p style="font-size: 60%"><a href="https://doc.rust-lang.org/cargo/reference/manifest.html" target="_blank">https://doc.rust-lang.org/cargo/reference/manifest.html</a></p>
					<pre><code data-trim datanoescape class="ini">
						[package]
						name = "hello"
						version = "0.1.0"
						authors = ["name &lt;my@email.com&gt;"]

						[dependencies]
					</code></pre>
				</section>
				<section>
					<h2>.gitignore</h2>
					<pre><code data-trim data-noescape class="sh">
						# Generated by Cargo
						# will have compiled files and executables
						/target/
						
						# Remove Cargo.lock from gitignore if creating an executable, leave it for libraries
						# More information here https://doc.rust-lang.org/cargo/guide/cargo-toml-vs-cargo-lock.html
						Cargo.lock
						
						# These are backup files generated by rustfmt
						**/*.rs.bk
					</code></pre>
					<p style="font-size: 60%"><a href="https://github.com/github/gitignore/blob/master/Rust.gitignore" target="_blank">https://github.com/github/gitignore/blob/master/Rust.gitignore</a></p>
				</section>
				<section>
					<h2>cargo</h2>
					<pre><code data-trim data-noescape>
						.
						├── Cargo.lock
						├── Cargo.toml
						├── build.rs
						├── benches
						│   └── large-input.rs
						├── examples
						│   └── simple.rs
						├── src
						│   ├── bin
						│   │   └── another_executable.rs
						│   ├── lib.rs
						│   └── main.rs
						└── tests
						    └── some-integration-tests.rs</code></pre>
				</section>
				<section>
					<h2>cargo</h2>
					<pre><code data-trim data-noescape class="sh">
						cargo doc
						open target/doc/hello/index.html
					</code></pre>
					<pre><code data-trim data-noescape class="rust">
						/// This comment documents the `foo` function.
						///
						/// You can use the `rustdoc` tool via `cargo doc` to generate
						/// HTML documentation from these comments!
						fn foo() {
							// ...
						}
					</code></pre>
				</section>
				<section>
					<h2>cargo</h2>
					<pre><code data-trim data-noescape class="sh">~/.cargo/bin</code></pre>
					<pre class="fragment"><code data-trim data-noescape class="sh">cargo install ripgrep https</code></pre>
					<pre class="fragment"><code data-trim data-noescape class="sh">cargo install cargo-watch</code></pre>
					<pre class="fragment"><code data-trim data-noescape class="sh">cargo install cargo-make</code></pre>
					<pre class="fragment"><code data-trim data-noescape class="sh">cargo install --list</code></pre>
				</section>
				<section>
					<h2>IDE &amp; Editor</h2>
					<ul>
						<li><a href="https://areweideyet.com/" target="_blank">https://areweideyet.com/</a></li>
						<li>RLS</li>
						<li>Visual Studio Code + Rust (rls)</li>
						<li>IntelliJ / CLion + Rust plugin</li>
					</ul>
				</section>
				<section>
					<h2>clippy</h2>
					<blockquote>A collection of lints to catch common mistakes and improve your Rust code.</blockquote>
					<dl>
						<dt>install</dt>
						<dd>
							<pre><code data-trim data-noescape class="sh">
								rustup install nightly
								cargo +nightly install --force clippy
							</code></pre>
						</dd>
						<dt>run</dt>
						<dd>
							<pre><code data-trim data-noescape class="sh">
								cargo +nightly clippy
							</code></pre>
						</dd>
					</dl>
				</section>
				<section align="center">
					<h2>debugger</h2>
					<p>via GDB / LLDB</p>
					<p><i class="fas fa-frown fa-5x"></i></p>
					<p><a href="https://bryce.fisher-fleig.org/blog/debugging-rust-programs-with-lldb/index.html" target="_blank">Debugging Rust programs with lldb on MacOS | Bryce Fisher-Fleig</a></p>
				</section>
				<section>
					<h2>profiler</h2>
					<ul>
						<li><a href="http://valgrind.org/" target="_blank">Valgrind</a></li>
						<li><a href="https://bluejekyll.github.io/blog/rust/2017/12/29/making-trust-dns-fast.html" target="_blank">Making TRust-DNS faster than BIND9</a></li>
						<li><a href="https://gist.github.com/jFransham/369a86eff00e5f280ed25121454acec1" target="_blank">Rust Optimization.md</a></li>
						<li><a href="http://carol-nichols.com/2015/12/09/rust-profiling-on-osx-cpu-time/" target="_blank">Rust Profiling with Instruments and FlameGraph on OSX: CPU/Time</a></li>
						<li><a href="https://github.com/RazrFalcon/cargo-bloat" target="_blank">cargo-bloat</a></li>
					</ul>
				</section>
				<section>
					<h2>benchmarks</h2>
					<ul>
						<li><a href="" target="_blank">libtest benchmarks</a>
							<pre><code data-trim data-noescape>
								cargo +nightly bench
							</code></pre>	
						</li>
						<li><a href="https://bheisler.github.io/post/benchmarking-with-criterion-rs/" target="_blank">with Criterion.rs</a>
							<pre><code data-trim data-noescape>
								cargo bench

								Running target/release/deps/bench1-0a8dde0ccacc35ee
								fib 20                  time:   [25.800 us 26.114 us 26.453 us]
								Found 3 outliers among 100 measurements (3.00%)
								  1 (1.00%) high mild
								  2 (2.00%) high severe

								Running target/release/deps/bench1-0a8dde0ccacc35ee
								fib 20                  time:   [25.662 us 25.993 us 26.302 us]
								                        change: [-5.4472% -3.3608% -1.1502%] (p = 0.00 < 0.05)
								                        Performance has improved.
								Found 5 outliers among 100 measurements (5.00%)
								  5 (5.00%) high mild
							</code></pre>	
						</li>
					</ul>
				</section>
				<section>
					<h2><a href="https://crates.io/" target="_blank">https://crates.io/</a></h2>
					<ul>
						<li>errors: failures (error_chain)</li>
						<li>logging: env_logger, slog, ...</li>
						<li>monitoring: prometheus</li>
						<li>tracing: opentracing</li>
						<li>marchaling: serde (rustc-serialize), protobuff</li>
						<li>protocol: http, gRPC, tower</li>
						<li>web: hyper, reqwest, ...</li>
						<li>concurrent: thread, rayon, futures/tokio, may, simd</li>
						<li>db client: diesel, postgres, mongodb, dgraph, ...</li>
						<li>db: (<a href="https://github.com/mozilla/mentat">mentat</a>, <a href="https://github.com/pingcap/tidb">tidb</a>)</li>
						<li>os: (<a href="https://www.redox-os.org/">redox-os</a>)</li>
					</ul>
					<aside class="notes">bcq version 0.x</aside>
				</section>
				<section class="questions" data-state="flash" align="center">
					<i class="fas fa-question fa-10x"></i>
				</section>
			</section>
			<section>
				<section data-state="flash" align="center">
					<h1>Préparation</h1>
					<aside class="notes">assemblage de libs et de code pour faire un service avec une api web (http + graphql)</aside>
				</section>
				<section>
					<h2>Serveur HTTP</h2>
					<ul>
						<li><a href="https://github.com/actix/actix-web">actix-web</a> : asynchrone, basé sur des acteurs</li>
						<li><a href="https://gotham.rs">gotham</a> : asynchrone</li>
						<li><a href="https://rocket.rs">rocket</a> : rust nightly, utilise les attributs</li>
						<li><a href="http://ironframework.io">iron</a> : stable, plus maintenu</li>
						<li><a href="https://hyper.rs">hyper</a> : bas niveau</li>
						<li><a href="https://github.com/tokio-rs/tokio-minihttp">tokio-minihttp</a> : très bas niveau</li>
					</ul>
				</section>
				<section>
					<h2>Autres crates utiles</h2>
					<ul>
						<li>http, mime : types pour les requêtes HTTP</li>
						<li>futures, hyper, rayon, may : asynchrone &amp; concurrence</li>
						<li>lazy_static : variable statique lazy</li>
						<li>diesel, r2d2 : ORM &amp; pool de connections</li>
						<li>serde, serde_derive, serde_json</li>
						<li>itertools : helpers pour les iterators</li>
						<li>reqwest : requêtes HTTP bloquantes</li>
						<li>log, env_logger, slog, fern : logs et configuration</li>
						<li>clap : parser de ligne de commande</li>
						<li>uuid, chrono : types utiles</li>
					</ul>
				</section>
				<section>
					<h2>Premier service: Ratings</h2>
					<pre><code data-trim data-noescape class="console">
						curl localhost:9080/ratings/0
						{
							"id" : 0,
							"ratings" : {
								"Reviewer2" : 4,
								"Reviewer1" : 5
							}
						}</code></pre>
					<ul>
						<li>gotham</li>
						<li>serde</li>
						<li>lazy_static, Arc, Mutex</li>
					</ul>
				</section>
				<section>
					<h2>code</h2>
					<dt>gotham <span class="git-branch"><i class="fab fa-github"></i> ratings-gotham</span></dt>
					<ul>
						<li><a href="https://gotham.rs">https://gotham.rs</a></li>
						<li>router les requêtes</li>
						<li>retourner une réponse</li>
						<li>lire le body d'une requête</li>
					</ul>
					<dt>serde <span class="git-branch"><i class="fab fa-github"></i> ratings-serde</span></dt>
					<ul>
						<li><a href="https://serde.rs">https://serde.rs</a></li>
						<li>permet de sérialiser / déserialiser par dérivation automatique</li>
						<li>supporte JSON, URL encoded, XML, BSON, ...</li>
						<li>configuration : <a href="https://serde.rs/attributes.html">https://serde.rs/attributes.html</a></li>
					</ul>
				</section>
				<section>
					<h2>code</h2>
					<dt>lazy_static, Arc, Mutex <span class="git-branch"><i class="fab fa-github"></i> ratings-db</span></dt>
					<ul>
						<li><a href="https://crates.io/crates/lazy_static">https://crates.io/crates/lazy_static</a></li>
						<li>variable statique initialisée à sa première utilisation</li>
						<li><a href="https://manishearth.github.io/blog/2015/05/27/wrapper-types-in-rust-choosing-your-guarantees/">Choisir ses garanties</a></li>
						<li>Atomic reference count + Mutex : tout le monde peut devenir owner et modifier les données dans un environment multithread</li>
						<li>Box, Cow, Rc, Arc, Cell, RefCell, Mutex, RwLock</li>
					</ul>
				</section>
				<section class="questions" data-state="flash" align="center">
					<i class="fas fa-question fa-10x"></i>
				</section>
			</section>
			<section>
				<section data-state="flash" align="center">
					<h1>Cuisson</h1>
					<aside class="notes">la sécurité, healthcheck/heartbeat, metrics, logs, traces, ... dashboard</aside>
				</section>
				<section>
					<h2>Tests</h2>
					<ul>
						<li>tests unitaires</li>
						<li>découpage en binaire + library</li>
						<li>test d'intégration</li>
						<li>test de doc</li>
						<li><span class="git-branch"><i class="fab fa-github"></i> ratings-tests</span></li>
					</ul>
				</section>
				<section>
					<h2>Travis CI</h2>
					<pre><code data-trim data-noescape class="yaml">
						# .travis.yml
						language: rust
						rust:
							- stable
							- beta
							- nightly
						matrix:
							allow_failures:
								- rust: nightly
							fast_finish: true
							include:
								- rust: stable
									env: RUSTFMT
									install:
										- rustup component add rustfmt-preview
									script:
										- cargo fmt -- --write-mode=diff
						cache: cargo
					</code></pre>
				</section>
				<section>
					<h2>Configuration</h2>
					<ul>
						<li>chargée de l'environment : std::env</li>
						<li>chargée de la ligne de commande
							<ul>
								<li><a href="https://github.com/kbknapp/clap-rs">clap-rs</a> : permet de tout configurer</li>
								<li><a href="https://github.com/docopt/docopt.rs">docopt.rs</a> : génerer à partir de la doc usage</li>
							</ul>
						</li>
						<li>struct Config disponible avec lazy_static</li>
						<li><span class="git-branch"><i class="fab fa-github"></i> ratings-config</span></li>
					</ul>
				</section>
				<section>
					<h2>Logs</h2>
					<ul>
						<li><a href="https://docs.rs/log">log</a> : fonctions de base</li>
						<li><a hreh="https://docs.rs/env_logger/*/env_logger/">env_logger</a> : configuration minimale, permet de choisir le niveau de log par variable d'environment</li>
						<li><a href="https://docs.rs/fern/*/fern/">fern</a> : beaucoup de configuration possible</li>
						<li><a href="https://docs.rs/slog/*/slog/">slog</a> : beaucoup de points d'extension possible (<a href="https://crates.io/search?q=slog">liste</a>)</li>
						<li><span class="git-branch"><i class="fab fa-github"></i> ratings-logs</span></li>
					</ul>
					TODO code (startup/shutdown)
					TODO endpoint log
					TODO metrics capture
				</section>
				<section>
					<h2>(Custom) Metrics</h2>
					TODO code (prometheus ou telegraph ?) + config (k8s)
					blackbox (vs whitebox)
					app or business metrics or ...
					but not system resources, or request
					SLI (not SLO)
				</section>
				<section>
					<h2>Tracing</h2>
					TODO
				</section>
				<section>
					<h2>HealthCheck/Liveness</h2>
					<ul>
						<li><a href="https://docs.rs/time/*/time/">time</a> pour avoir un timestamp</li>
						<li><a href="https://docs.rs/chrono/*/chrono/">chrono</a> pour avoir une date formatée</li>
						<li><a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-sets-for-crates">env!</a> pour accèder à certaines des informations de build</li>
						<li><a href="https://doc.rust-lang.org/cargo/reference/build-scripts.html">script de build</a> pour le reste (git ref, date de build, ...)</li>
						<li><span class="git-branch"><i class="fab fa-github"></i> ratings-healthcheck</span></li>
					</ul>
					TODO code (version + now) + config (k8s)
				</section>
				<section>
					<h2>Readiness</h2>
					TODO code (after 10s) + config (k8s)
				</section>
				<section class="questions" data-state="flash" align="center">
					<i class="fas fa-question fa-10x"></i>
				</section>
			</section>
			<section>
				<section data-state="flash" align="center">
					<h1>Dressage</h1>
					<aside class="notes">"containerisation" &amp; déploiement (avec un frontal web, mini test de charge avec wrk, ...)</aside>
				</section>
				<section>
					<h2>Services</h2>
					TODO archi overview dessin
				</section>
				<section>
					<h2>Second service: Reviews</h2>
					<pre><code data-trim data-noescape class="sh">
						curl localhost:9080/reviews/0
						{
							"id" : 0,
							"reviews" : [
								{
									"text" : "An extremely entertaining play by Shakespeare.",
									"rating" : { "color" : "blue", "stars" : 5 },
									"reviewer" : "Reviewer1"
								},
								...
							]
						}
					</code></pre>
					<ul>
						<li>actix-web, actix</li>
						<li>diesel</li>
						<li>chaînage de futures</li>
					</ul>
				</section>
				<section>
					<h2>code</h2>
					<dt>actix-web <span class="git-branch"><i class="fab fa-github"></i> reviews-actix-web</span></dt>
					<ul>
						<li>https://github.com/actix/actix-web</li>
						<li>router les requêtes</li>
						<li>retourner une réponse</li>
						<li>les extractors</li>
					</ul>
					<dt>actix <span class="git-branch"><i class="fab fa-github"></i> reviews-actix</span></dt>
					<ul>
						<li>https://github.com/actix/actix</li>
						<li>créer un acteur et un type de message</li>
						<li>envoyer un message et attendre la réponse</li>
					</ul>
				</section>
				<section>
					<h2>code</h2>
					<dt>diesel <span class="git-branch"><i class="fab fa-github"></i> reviews-diesel</span></dt>
					<ul>
						<li>http://diesel.rs</li>
						<li>diesel_cli
							<pre><code data-trim data-noescape class="sh">
								cargo install diesel_cli
								DATABASE_URL=test.sqlite diesel setup
							</code></pre>
						</li>
						<li>écrire la première migration
							<pre><code data-trim data-noescape class="sh">
									diesel migration generate reviews
									DATABASE_URL=test.sqlite diesel migration run
									DATABASE_URL=test.sqlite diesel print-schema > src/schema.rs
								</code></pre>
							</li>
							<li>écrire une requête</li>
					</ul>
				</section>
				<section>
					<h2>code</h2>
					<dt>les futures <span class="git-branch"><i class="fab fa-github"></i> reviews-futures</span></dt>
					<ul>
						<li>chainer les futures : map, and_then</li>
						<li>définir ses erreurs : failures</li>
						<li>gérer les erreurs : from_err, map_err, or_else</li>
						<li>retourner un future : Box</li>
					</ul>
				</section>
				<section>
					<h2>Dockerfile</h2>
					<p>see <a href="https://github.com/michiel/docker-rust-microservice" target="_blank">https://github.com/michiel/docker-rust-microservice</a></p>
					<p><a href="https://alpinelinux.org/" target="_blank">Alpine Linux</a> uses <a href="https://www.musl-libc.org" target="_blank">musl-libc</a> instead of glibc, which is the default for most common distributions.</p>
					<pre><code>rustup target add x86_64-unknown-linux-musl</code></pre>
					<p>Once that is installed we can explicitly target it when building the service,</p>
					<pre><code>cargo build --target x86_64-unknown-linux-musl --release</code></pre>
					TODO the code
				</section>
				<section>
					<h2>Dockerfile multi-stage</h2>
					TODO
				</section>
				<section>
					<h2>Deployement</h2>
				</section>
				<section class="questions" data-state="flash" align="center">
					<i class="fas fa-question fa-10x"></i>
				</section>
			</section>
			<section>
				<section data-state="flash" align="center">
					<h1>Dégustation</h1>
					<aside class="notes">est-ce mangeable? quels sont les saveurs, sucré, salé, épicé, amer ?</aside>
				</section>
				<section>
					<h2>Troll en vrac</h2>
					<ul>
						<li>taille des images docker</li>
						<li>garbage collector vs ownership</li>
						<li>jit</li>
						<li>temps de démarrage (et pas de chauffage)</li>
						<li>courbe d'apprentissage</li>
						<li>syntax et paradigmes "modernes"</li>
						<li>maturité</li>
						<li>ecosystem, support</li>
					</ul>
				</section>
				<section>
					<h2>Reviews &amp; Graphql</h2>
					<pre><code data-trim data-noescape class="sh">

						curl http://127.0.0.1:9080/graphql -d '{"query":"{products{id,reviews{text,rating{stars}}}}"}'
						{
							"data" : {
								"products" : [
									{
										"reviews" : [
										{
											"text" : "An extremely entertaining play by Shakespeare.",
											"rating" : { "stars" : 5 }
										},
										...
										]
									}
								]
							}
						}
					</code></pre>
					<ul>
						<li>juniper</li>
						<li>attendre le futur, reqwest</li>
					</ul>
				</section>
				<section>
					<h2>code</h2>
					<dt>juniper <span class="git-branch"><i class="fab fa-github"></i> graphql-juniper</span></dt>
					<ul>
						<li>version simple : tout en dérivation automatique</li>
						<li>endpoint graphql, graphiql (+ cors)</li>
					</ul>
					<dt>bloquant <span class="git-branch"><i class="fab fa-github"></i> graphql-data</span></dt>
					<ul>
						<li>attendre le futur de la requête à la base de données</li>
						<li>reqwest pour requête http bloquante</li>
					</ul>
				</section>
				<section>
					<h2>code</h2>
					<dt>juniper <span class="git-branch"><i class="fab fa-github"></i> graphql-filter</span></dt>
					<ul>
						<li>définit le trait manuellement</li>
						<li>permet de ne récupérer les données d'un champ que si il est demandé</li>
					</ul>
				</section>
				<section>
					<h2>Introduire Rust</h2>
					<ul>
						<li>cli tools: ripgrep (rg), exa, xsv...</li>
						<li>server &amp; microservices: business, tooling (infra, security, build, test (i'Krelln))</li>
						<li>side-car, agent, proxy services</li>
						<li>function (FaaS)</li>
						<li>databases: TiDB, memat</li>
						<li>webclient: "target webassembly"</li>
						<li>embedded</li>
						<li>fragment code optimisé (pour intégration)</li>
						<li><a href="https://www.rust-lang.org/en-US/friends.html" target="_blank">https://www.rust-lang.org/en-US/friends.html</a></li>
					</ul>
					<aside class="notes">Conduit (side-car), chaos manager,</aside>
				</section>
				<section>
					<h2>Jouer avec Rust</h2>
					<ul>
						<li>Contribuer a des crates opensource</li>
						<li>CodinGame, ...</li>
						<li>exercism.io</li>
						<li>???</li>
					</ul>
					<aside class="notes"></aside>
				</section>
				<section class="questions" data-state="flash" align="center">
					<i class="fas fa-question fa-10x"></i>
				</section>
			</section>
			<section>
				<section data-state="flash" align="center">
					<h1>Merci</h1>
					<a href="https://davidb.github.io/labs_cooking_microservices_with_rust" target="_blank">https://davidb.github.io/labs_cooking_microservices_with_rust</a>
				</section>
			</section>
		</div>
		<div class="footer">
			<p>#DevoxxFR</p>
			<img align="right" src="images/logos Devoxx France/logo-texte-devoxx-france-400.png" />
		</div>
	</div>

	<script src="lib/js/head.min.js"></script>
	<script src="js/reveal.js"></script>
	<script src="js/asciinema-player.js"></script>

	<script>
		// More info about config et dependencies:
		// - https://github.com/hakimel/reveal.js#configuration
		// - https://github.com/hakimel/reveal.js#dependencies
		Reveal.initialize({
			history: true,
			center: false,
			controls: false,
			progress: true,
			width: 1280,
			height: 720,
			slideNumber: true,
			margin: 0.0,
			dependencies: [
				//{ src: 'plugin/markdown/marked.js' },
				//{ src: 'plugin/markdown/markdown.js' },
				{ src: 'plugin/notes/notes.js', async: true },
				{ src: 'plugin/highlight/highlight.pack.js', async: true },
				{ src: 'plugin/highlight/highlight.js', async: true, callback: function () { hljs.initHighlightingOnLoad(); } }
			]
		});
	</script>
</body>

</html>